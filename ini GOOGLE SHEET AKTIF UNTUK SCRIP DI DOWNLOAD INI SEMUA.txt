function doGet(e) {
  try {
    const ss = SpreadsheetApp.openById("1Z3Cx8hJdhY7CEd_xT7kSCXZu1MbwsqJGigGRMuPRuvw");
    const sheetNames = [
      "Dasbor Utama",
      "Pembagian Tugas",
      "Jadwal Mingguan",
      "Daftar Pendamping",
      "Daftar Peserta",
      "Program Kerja"
    ];

    let result = {};

    sheetNames.forEach(name => {
      result[name] = getSheetData(ss, name);
    });

    return ContentService
      .createTextOutput(JSON.stringify({
        status: "success",
        data: result
      }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ status: "error", message: err.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function getSheetData(ss, sheetName) {
  const sheet = ss.getSheetByName(sheetName);
  if (!sheet) return [];

  const lastRow = sheet.getLastRow();
  const lastCol = sheet.getLastColumn();
  if (lastRow < 2) return [];

  const data = sheet.getRange(1, 1, lastRow, lastCol).getValues();
  const header = data.shift();

  return data.map(row => {
    let obj = {};
    header.forEach((h, i) => obj[h] = row[i]);
    return obj;
  });
}
